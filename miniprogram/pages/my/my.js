"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const request_service_1 = require("../../services/request-service");
const authen_service_1 = require("../../services/authen-service");
var app = getApp();
Page({
    data: {
        userInfo: {},
        hasUserInfo: false,
    },
    onLoad: function () {
        if (authen_service_1.authenService.getUserInfo()) {
            this.setData({
                userInfo: authen_service_1.authenService.getUserInfo(),
                hasUserInfo: true,
            });
        }
    },
    onReady: function () {
    },
    onShow: function () {
        if (typeof this.getTabBar === 'function' &&
            this.getTabBar()) {
            this.getTabBar().setData({
                selected: 3
            });
        }
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    onPullDownRefresh: function () {
    },
    onReachBottom: function () {
    },
    onShareAppMessage: function () {
    },
    login() {
        const that = this;
        wx.login({
            success(res) {
                console.log("code", res.code);
                app.globalData.code = res.code;
                console.log("codeGLO", app.globalData.code);
                if (res.code) {
                    const business = app.globalData.code;
                    request_service_1.requestService.get('wx/code2Session/', { business }, {}, true, true)
                        .then((e) => {
                        console.log("登录成功", e);
                        console.log("token", e.data.data.token);
                        authen_service_1.authenService.saveToken(e.data.data.token);
                        authen_service_1.authenService.saveUserId(e.data.data.user.id);
                    });
                }
                else {
                    console.log('登录失败！' + res.errMsg);
                }
            }
        });
    },
    getUserInfo(e) {
        console.log(e);
        app.globalData.userInfo = e.detail.userInfo;
        authen_service_1.authenService.saveUserInfo(e.detail.userInfo);
        if (e.detail.userInfo) {
            this.setData({
                userInfo: e.detail.userInfo,
                hasUserInfo: true,
            });
            this.recordUserInfo();
        }
    },
    recordUserInfo() {
        request_service_1.requestService.post('user/', {
            id: authen_service_1.authenService.getUserId(),
            nickName: app.globalData.userInfo.nickName,
            openid: '',
            session_key: '',
            unionid: ''
        }).then(res => {
            console.log("后台注册", res);
        });
    },
    toMyCollect() {
        wx.navigateTo({
            url: 'myCollect'
        });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJteS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLG9FQUE4RDtBQUM5RCxrRUFBNEQ7QUFDNUQsSUFBSSxHQUFHLEdBQU8sTUFBTSxFQUFPLENBQUM7QUFDNUIsSUFBSSxDQUFDO0lBS0gsSUFBSSxFQUFFO1FBQ0YsUUFBUSxFQUFFLEVBQUU7UUFDWixXQUFXLEVBQUUsS0FBSztLQUVyQjtJQUtELE1BQU0sRUFBRTtRQUVKLElBQUksOEJBQWEsQ0FBQyxXQUFXLEVBQUUsRUFBRTtZQUM3QixJQUFJLENBQUMsT0FBTyxDQUFDO2dCQUNULFFBQVEsRUFBRSw4QkFBYSxDQUFDLFdBQVcsRUFBRTtnQkFDckMsV0FBVyxFQUFFLElBQUk7YUFDcEIsQ0FBQyxDQUFBO1NBQ0w7SUFDTCxDQUFDO0lBS0QsT0FBTyxFQUFFO0lBRVQsQ0FBQztJQUtELE1BQU0sRUFBRTtRQUNKLElBQUksT0FBTyxJQUFJLENBQUMsU0FBUyxLQUFLLFVBQVU7WUFDcEMsSUFBSSxDQUFDLFNBQVMsRUFBRSxFQUFFO1lBQ2xCLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxPQUFPLENBQUM7Z0JBQ3JCLFFBQVEsRUFBRSxDQUFDO2FBQ2QsQ0FBQyxDQUFBO1NBQ0w7SUFDTCxDQUFDO0lBS0QsTUFBTSxFQUFFO0lBRVIsQ0FBQztJQUtELFFBQVEsRUFBRTtJQUVWLENBQUM7SUFLRCxpQkFBaUIsRUFBRTtJQUVuQixDQUFDO0lBS0QsYUFBYSxFQUFFO0lBRWYsQ0FBQztJQUtELGlCQUFpQixFQUFFO0lBRW5CLENBQUM7SUFDQyxLQUFLO1FBQ0wsTUFBTSxJQUFJLEdBQUcsSUFBVyxDQUFDO1FBQ3JCLEVBQUUsQ0FBQyxLQUFLLENBQUM7WUFDTCxPQUFPLENBQUUsR0FBTztnQkFDWixPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzdCLEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxHQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUM7Z0JBQzdCLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzNDLElBQUksR0FBRyxDQUFDLElBQUksRUFBRTtvQkFFVixNQUFNLFFBQVEsR0FBRyxHQUFHLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQztvQkFDckMsZ0NBQWMsQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEVBQUUsRUFBQyxRQUFRLEVBQUMsRUFBQyxFQUFFLEVBQUMsSUFBSSxFQUFDLElBQUksQ0FBQzt5QkFDMUQsSUFBSSxDQUFDLENBQUMsQ0FBSyxFQUFDLEVBQUU7d0JBQ2YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ3RCLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUV2Qyw4QkFBYSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQzt3QkFDM0MsOEJBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO29CQUVsRCxDQUFDLENBQUMsQ0FBQztpQkFFTjtxQkFBTTtvQkFDSCxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUE7aUJBQ3BDO1lBQ0wsQ0FBQztTQUNKLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFFRCxXQUFXLENBQUMsQ0FBTTtRQUNkLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDZixHQUFHLENBQUMsVUFBVSxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQztRQUM1Qyw4QkFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzlDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUU7WUFDbkIsSUFBSSxDQUFDLE9BQU8sQ0FBQztnQkFDVCxRQUFRLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRO2dCQUMzQixXQUFXLEVBQUUsSUFBSTthQUNwQixDQUFDLENBQUE7WUFDRixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7U0FDekI7SUFFTCxDQUFDO0lBRUQsY0FBYztRQUNaLGdDQUFjLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBQztZQUN4QixFQUFFLEVBQUMsOEJBQWEsQ0FBQyxTQUFTLEVBQUU7WUFDNUIsUUFBUSxFQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLFFBQVE7WUFDekMsTUFBTSxFQUFDLEVBQUU7WUFDVCxXQUFXLEVBQUMsRUFBRTtZQUNkLE9BQU8sRUFBQyxFQUFFO1NBQ2IsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUEsRUFBRTtZQUNULE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzVCLENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVELFdBQVc7UUFDUCxFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1YsR0FBRyxFQUFDLFdBQVc7U0FDbEIsQ0FBQyxDQUFBO0lBQ04sQ0FBQztDQUNKLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIG1pbmlwcm9ncmFtL3BhZ2VzL215L215LmpzXHJcbmltcG9ydCB7cmVxdWVzdFNlcnZpY2V9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9yZXF1ZXN0LXNlcnZpY2VcIjtcclxuaW1wb3J0IHthdXRoZW5TZXJ2aWNlfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvYXV0aGVuLXNlcnZpY2VcIjtcclxudmFyIGFwcDphbnkgPSBnZXRBcHA8YW55PigpO1xyXG5QYWdlKHtcclxuXHJcbiAgLyoqXHJcbiAgICog6aG16Z2i55qE5Yid5aeL5pWw5o2uXHJcbiAgICovXHJcbiAgZGF0YToge1xyXG4gICAgICB1c2VySW5mbzoge30sXHJcbiAgICAgIGhhc1VzZXJJbmZvOiBmYWxzZSxcclxuXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLliqDovb1cclxuICAgKi9cclxuICBvbkxvYWQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgLy8g55yL57yT5a2Y5Lit5piv5ZCm6L+Y5pyJ55So5oi35L+h5oGvXHJcbiAgICAgIGlmIChhdXRoZW5TZXJ2aWNlLmdldFVzZXJJbmZvKCkpIHtcclxuICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgICAgICAgdXNlckluZm86IGF1dGhlblNlcnZpY2UuZ2V0VXNlckluZm8oKSxcclxuICAgICAgICAgICAgICBoYXNVc2VySW5mbzogdHJ1ZSxcclxuICAgICAgICAgIH0pXHJcbiAgICAgIH1cclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWIneasoea4suafk+WujOaIkFxyXG4gICAqL1xyXG4gIG9uUmVhZHk6IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLmmL7npLpcclxuICAgKi9cclxuICBvblNob3c6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgaWYgKHR5cGVvZiB0aGlzLmdldFRhYkJhciA9PT0gJ2Z1bmN0aW9uJyAmJlxyXG4gICAgICAgICAgdGhpcy5nZXRUYWJCYXIoKSkge1xyXG4gICAgICAgICAgdGhpcy5nZXRUYWJCYXIoKS5zZXREYXRhKHtcclxuICAgICAgICAgICAgICBzZWxlY3RlZDogM1xyXG4gICAgICAgICAgfSlcclxuICAgICAgfVxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i6ZqQ6JePXHJcbiAgICovXHJcbiAgb25IaWRlOiBmdW5jdGlvbiAoKSB7XHJcblxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Y246L29XHJcbiAgICovXHJcbiAgb25VbmxvYWQ6IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog6aG16Z2i55u45YWz5LqL5Lu25aSE55CG5Ye95pWwLS3nm5HlkKznlKjmiLfkuIvmi4nliqjkvZxcclxuICAgKi9cclxuICBvblB1bGxEb3duUmVmcmVzaDogZnVuY3Rpb24gKCkge1xyXG5cclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDpobXpnaLkuIrmi4nop6blupXkuovku7bnmoTlpITnkIblh73mlbBcclxuICAgKi9cclxuICBvblJlYWNoQm90dG9tOiBmdW5jdGlvbiAoKSB7XHJcblxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOeUqOaIt+eCueWHu+WPs+S4iuinkuWIhuS6q1xyXG4gICAqL1xyXG4gIG9uU2hhcmVBcHBNZXNzYWdlOiBmdW5jdGlvbiAoKTphbnkge1xyXG5cclxuICB9LFxyXG4gICAgbG9naW4oKXtcclxuICAgIGNvbnN0IHRoYXQgPSB0aGlzIGFzIGFueTtcclxuICAgICAgICB3eC5sb2dpbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3MgKHJlczphbnkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY29kZVwiLHJlcy5jb2RlKTtcclxuICAgICAgICAgICAgICAgIGFwcC5nbG9iYWxEYXRhLmNvZGU9cmVzLmNvZGU7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvZGVHTE9cIixhcHAuZ2xvYmFsRGF0YS5jb2RlKTtcclxuICAgICAgICAgICAgICAgIGlmIChyZXMuY29kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8v5Y+R6LW3572R57uc6K+35rGCXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYnVzaW5lc3MgPSBhcHAuZ2xvYmFsRGF0YS5jb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RTZXJ2aWNlLmdldCgnd3gvY29kZTJTZXNzaW9uLycsIHtidXNpbmVzc30se30sdHJ1ZSx0cnVlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoZTphbnkpPT57XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi55m75b2V5oiQ5YqfXCIsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidG9rZW5cIixlLmRhdGEuZGF0YS50b2tlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOW8leeUqOiHquWumuS5ieeahGF1dGhlblNlcnZpY2XmnI3liqHkv53lrZh0b2tlbiDlkowgdXNlcklkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhlblNlcnZpY2Uuc2F2ZVRva2VuKGUuZGF0YS5kYXRhLnRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXV0aGVuU2VydmljZS5zYXZlVXNlcklkKGUuZGF0YS5kYXRhLnVzZXIuaWQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfnmbvlvZXlpLHotKXvvIEnICsgcmVzLmVyck1zZylcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9LFxyXG4gICAgLy8g6I635Y+W55So5oi35L+h5oGvXHJcbiAgICBnZXRVc2VySW5mbyhlOiBhbnkpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlKTtcclxuICAgICAgICBhcHAuZ2xvYmFsRGF0YS51c2VySW5mbyA9IGUuZGV0YWlsLnVzZXJJbmZvO1xyXG4gICAgICAgIGF1dGhlblNlcnZpY2Uuc2F2ZVVzZXJJbmZvKGUuZGV0YWlsLnVzZXJJbmZvKTtcclxuICAgICAgICBpZiAoZS5kZXRhaWwudXNlckluZm8pIHtcclxuICAgICAgICAgICAgdGhpcy5zZXREYXRhKHtcclxuICAgICAgICAgICAgICAgIHVzZXJJbmZvOiBlLmRldGFpbC51c2VySW5mbyxcclxuICAgICAgICAgICAgICAgIGhhc1VzZXJJbmZvOiB0cnVlLFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB0aGlzLnJlY29yZFVzZXJJbmZvKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0sXHJcbiAgICAvLyDojrflj5bliLDnlKjmiLfkv6Hmga/lkI7vvIzmi7/lhbbkuK3nmoTkv6Hmga/ov5Tlm57nu5nlkI7lj7DvvIzorrDlvZXnlKjmiLfkv6Hmga9cclxuICAgIHJlY29yZFVzZXJJbmZvKCl7XHJcbiAgICAgIHJlcXVlc3RTZXJ2aWNlLnBvc3QoJ3VzZXIvJyx7XHJcbiAgICAgICAgICBpZDphdXRoZW5TZXJ2aWNlLmdldFVzZXJJZCgpLFxyXG4gICAgICAgICAgbmlja05hbWU6YXBwLmdsb2JhbERhdGEudXNlckluZm8ubmlja05hbWUsXHJcbiAgICAgICAgICBvcGVuaWQ6JycsXHJcbiAgICAgICAgICBzZXNzaW9uX2tleTonJyxcclxuICAgICAgICAgIHVuaW9uaWQ6JydcclxuICAgICAgfSkudGhlbihyZXM9PntcclxuICAgICAgICAgIGNvbnNvbGUubG9nKFwi5ZCO5Y+w5rOo5YaMXCIscmVzKTtcclxuICAgICAgfSlcclxuICAgIH0sXHJcbiAgICAvLyDov5vlhaXmiJHnmoTmlLbol4/or6bmg4XpobVcclxuICAgIHRvTXlDb2xsZWN0KCl7XHJcbiAgICAgICAgd3gubmF2aWdhdGVUbyh7XHJcbiAgICAgICAgICAgIHVybDonbXlDb2xsZWN0J1xyXG4gICAgICAgIH0pXHJcbiAgICB9LFxyXG59KSJdfQ==